<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Competition â€” Rugrats vs Filekeepers</title>
<style>
  :root {
    --bg: #DDECD5;
    --text: #222;
    --green: #1eff78;
    --orange: #ff9626;
    --mid: #111;
  }

  body {
    margin: 0;
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  header {
    text-align: center;
    padding: 1rem 0;
  }

  h1 {
    font-size: 2rem;
    font-weight: 800;
  }

  #week-label {
    font-size: 1rem;
    color: #555;
  }

  /* ===== Cinematic Beam Bar ===== */
  .bar-wrapper {
    position: relative;
    width: 95%;
    height: 45px;
    margin: 1.5rem auto;
    background: linear-gradient(90deg, var(--green), var(--orange));
    border-radius: 40px;
    overflow: hidden;
    box-shadow: 0 0 25px rgba(0,0,0,0.25) inset;
  }

  .beam {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background: radial-gradient(circle at 50% 50%, rgba(255,255,150,0.6) 0%, transparent 70%);
    mix-blend-mode: screen;
    animation: beamMove 6s linear infinite;
  }

  @keyframes beamMove {
    0% { transform: translateX(-60%); opacity: 0.5; }
    50% { transform: translateX(60%); opacity: 1; }
    100% { transform: translateX(-60%); opacity: 0.5; }
  }

  canvas#particles {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .bar-labels {
    display: flex;
    justify-content: space-between;
    width: 92%;
    margin: 0.5rem auto;
    font-weight: 700;
  }

  /* ===== Tables ===== */
  .dashboard {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 2rem;
    flex-wrap: wrap;
    width: 90%;
    margin: 0 auto;
  }

  .team {
    flex: 1;
    min-width: 500px;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    overflow: hidden;
  }

  h2 {
    text-align: center;
    color: var(--green);
    background: #f0fdf5;
    padding: 0.7rem;
    font-size: 1.3rem;
    font-weight: 800;
  }

  h2.orange { color: var(--orange); background: #fff5e9; }

  table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
  }

  th, td {
    padding: 8px;
    border-bottom: 1px solid #eee;
  }

  th {
    background: #79cc7d;
    color: white;
    font-weight: 700;
  }

  .team.orange th { background: #f59f3a; }

  tr:nth-child(even) td {
    background: #f9f9f9;
  }

  .sum-row {
    background: #333;
    color: white;
    font-weight: 700;
  }

  footer {
    text-align: center;
    font-size: 0.8rem;
    color: #777;
    margin-top: 1rem;
  }
</style>
</head>
<body>
<header>
  <h1>ðŸŒ¿ Monthly Competition â€” Week <span id="week-num">--</span></h1>
  <div class="bar-wrapper">
    <canvas id="particles"></canvas>
    <div class="beam"></div>
  </div>
  <div class="bar-labels">
    <span id="rugrats-label">ðŸŸ¢ Rugrats: 0% (0)</span>
    <span id="filekeepers-label">ðŸŸ  Filekeepers: 0% (0)</span>
  </div>
</header>

<div class="dashboard">
  <div class="team">
    <h2>ðŸŸ¢ Rugrats</h2>
    <table id="table-rugrats">
      <thead>
        <tr><th>Agent</th><th>ID</th><th>Cr Pull</th><th>Xfer</th><th>Total</th></tr>
      </thead>
      <tbody></tbody>
      <tfoot><tr class="sum-row"><td colspan="2">TOTAL</td><td id="rug-cr">0</td><td id="rug-xf">0</td><td id="rug-total">0</td></tr></tfoot>
    </table>
  </div>

  <div class="team orange">
    <h2 class="orange">ðŸŸ  Filekeepers</h2>
    <table id="table-filekeepers">
      <thead>
        <tr><th>Agent</th><th>ID</th><th>Cr Pull</th><th>Xfer</th><th>Total</th></tr>
      </thead>
      <tbody></tbody>
      <tfoot><tr class="sum-row"><td colspan="2">TOTAL</td><td id="fk-cr">0</td><td id="fk-xf">0</td><td id="fk-total">0</td></tr></tfoot>
    </table>
  </div>
</div>

<footer>Endless Marketing Services â€” Monthly Dashboard</footer>

<script>
const SHEET_ID = "1pkNqNi_k5Ez1L1cYuvsT64m4oduGPJ4R7nLxesw6nrE";
const API_KEY = "AIzaSyB0TtVnOafgkbRwCaqkSxPogGLUgyWqZaE";

function getWeek() {
  const now = new Date();
  const start = new Date(now.getFullYear(), 0, 1);
  const days = Math.floor((now - start) / (24 * 60 * 60 * 1000));
  return Math.ceil((days + start.getDay() + 1) / 7);
}

async function loadData() {
  const week = getWeek();
  document.getElementById("week-num").textContent = week;

  const teamRange = "Teams!A3:O100";
  const dataRange = `W${week}!A1:T100`;

  const teamURL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${teamRange}?key=${API_KEY}`;
  const dataURL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${dataRange}?key=${API_KEY}`;

  const [teamRes, dataRes] = await Promise.all([fetch(teamURL), fetch(dataURL)]);
  const teamData = (await teamRes.json()).values || [];
  const dataValues = (await dataRes.json()).values || [];

  const map = new Map();
  dataValues.slice(2).forEach(row => {
    const id = (row[0] || "").trim();
    const cr = Number(row[18] || 0);
    const xf = Number(row[19] || 0);
    const total = cr + xf;
    if (id) map.set(id, { cr, xf, total });
  });

  const fkBody = document.querySelector("#table-filekeepers tbody");
  const rrBody = document.querySelector("#table-rugrats tbody");
  fkBody.innerHTML = rrBody.innerHTML = "";

  let fkCr = 0, fkXf = 0, fkTot = 0;
  let rrCr = 0, rrXf = 0, rrTot = 0;

  teamData.forEach(row => {
    const fkName = (row[0] || "").trim();
    const fkId = (row[1] || "").trim();
    const rrName = (row[13] || "").trim();
    const rrId = (row[14] || "").trim();

    if (fkId) {
      const d = map.get(fkId) || { cr: 0, xf: 0, total: 0 };
      fkCr += d.cr; fkXf += d.xf; fkTot += d.total;
      fkBody.insertAdjacentHTML("beforeend", `<tr><td>${fkName}</td><td>${fkId}</td><td>${d.cr}</td><td>${d.xf}</td><td>${d.total}</td></tr>`);
    }
    if (rrId) {
      const d = map.get(rrId) || { cr: 0, xf: 0, total: 0 };
      rrCr += d.cr; rrXf += d.xf; rrTot += d.total;
      rrBody.insertAdjacentHTML("beforeend", `<tr><td>${rrName}</td><td>${rrId}</td><td>${d.cr}</td><td>${d.xf}</td><td>${d.total}</td></tr>`);
    }
  });

  document.getElementById("fk-cr").textContent = fkCr;
  document.getElementById("fk-xf").textContent = fkXf;
  document.getElementById("fk-total").textContent = fkTot;
  document.getElementById("rug-cr").textContent = rrCr;
  document.getElementById("rug-xf").textContent = rrXf;
  document.getElementById("rug-total").textContent = rrTot;

  const total = fkTot + rrTot || 1;
  const rugPct = (rrTot / total) * 100;
  const fkPct = (fkTot / total) * 100;
  document.getElementById("rugrats-label").textContent = `ðŸŸ¢ Rugrats: ${rugPct.toFixed(1)}% (${rrTot})`;
  document.getElementById("filekeepers-label").textContent = `ðŸŸ  Filekeepers: ${fkPct.toFixed(1)}% (${fkTot})`;
}
loadData();

const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");
let w, h, particles = [];

function resize() {
  w = canvas.width = canvas.offsetWidth;
  h = canvas.height = canvas.offsetHeight;
  particles = Array.from({ length: 150 }, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    speed: 0.4 + Math.random() * 0.7,
    size: Math.random() * 2,
    alpha: 0.3 + Math.random() * 0.7
  }));
}
window.addEventListener("resize", resize);
resize();

function animate() {
  ctx.clearRect(0, 0, w, h);
  particles.forEach(p => {
    p.x += p.speed;
    if (p.x > w) p.x = 0;
    ctx.fillStyle = `rgba(255,255,200,${p.alpha})`;
    ctx.fillRect(p.x, p.y, p.size, p.size);
  });
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
